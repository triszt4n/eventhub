<% content_for :javascripts do %>
  <%= javascript_pack_tag 'events' %>
<% end %>

<div class="row mt-5">
  <div class="col-12 col-lg-10">
      <h2>
        <%= @event.title %>
      </h2>
      <!-- <small class="text-success">
        You're following <i class="fas fa-check"></i>
      </small> -->
  </div>
  <div class="col-12 col-lg-2 mt-3 mt-lg-0 text-right">
    <form method="POST" action="/follow">
      <!-- alternative: javascript file fetch function! -->
      <% if false %>
        <button type="submit" class="btn btn-block btn-outline-primary">
          Follow event
        </button>
      <% elsif false %>
        <button type="submit" class="btn btn-block btn-outline-danger">
          Unfollow event
        </button>
      <% else %>
        <%= link_to 'Edit', edit_event_path(@event), class: 'btn btn-info' %>
        <%= link_to 'Delete', '#', class: 'btn btn-danger' %>
      <% end %>
    </form>
  </div>
</div>

<div class="mt-5">
  <div class="row mb-5 lead">
    <div class="col-12 col-lg-5">
      <%= @event.place %>
    </div>
    <div class="col-12 col-lg-7 text-lg-right">
      <strong>
        <%= l @event.start_date, format: :datetime %> - 
        <% if @event.start_date.to_date == @event.end_date.to_date %>
          <%= l @event.end_date, format: :time %>
        <% else %>
          <%= l @event.end_date, format: :datetime %>
        <% end %>
      </strong>
    </div>
  </div>
  <div class="row mb-2">
    <div class="font-weight-bold col-12 col-lg-auto">
      Theme of event:
    </div>
    <div class="col-12 col-lg-9">
      <%= @event.theme %>
    </div>
  </div>
  <div class="row">
    <div class="font-weight-bold col-12 col-lg-auto">
      Full description:
    </div>
    <div class="col-12 col-lg-9">
      <%= @event.full_desc %>
    </div>
  </div>
</div>

<div class="row mt-5 justify-content-end">
  <div class="col-auto">
    <strong>Organized by:</strong>
    <div class="media">
      <%= image_tag("profile.png", class: "profile-pic-mini mr-3") %>
      <div class="media-body">
        <h5 onclick="window.location.href = '/users/<%= @event.user.id %> ';" class="mb-0 mt-1 clickable">
          <%= @event.user.name %>
        </h5>
        <strong>Followers:</strong> <%= @event.user.followers.length %>
      </div>
    </div>
    <form method="POST" action="/follow">
      <!-- alternative: javascript file fetch function! -->
      <button type="submit" class="btn btn-sm btn-outline-primary float-right">
        Follow
      </button>
    </form>
  </div>
</div>

<ul class="nav nav-tabs mt-5">
  <li class="nav-item">
    <div class="nav-link clickable active" id="posts-btn">Posts (<%= @event.posts.length %>)</a>
  </li>
  <li class="nav-item">
    <div class="nav-link clickable" id="followers-btn">Followers (<%= @event.users.length %>)</a>
  </li>
</ul>

<div class="mt-4" id="posts">
  <div class="row my-4">
      <div class="col-12 text-right">
        <%= link_to 'New', new_event_post_path(@event), class: 'btn btn-primary' %>
      </div>
  </div>

  <% @event.posts.each do |post| %>
    <div class="card bg-light mb-3">
      <div class="card-body">
        <h5 class="card-title clickable" onclick="window.location.href = '/posts/<%= post.id %> ';">
          <button href="#" class="btn btn-danger float-right">
            <i class="fas fa-trash"></i>
          </button>
          <%= post.title %>
        </h5>
        <h6 class="card-subtitle mb-2 text-muted">
          <i class="fas fa-paper-plane"></i>&nbsp;<%= l post.created_at, format: :datetime %>
        </h6>
        <p class="card-text">
          <%= post.body %>
        </p>
      </div>
    </div>
  <% end %>
</div>

<div class="mt-4 d-none" id="followers">
  <% @event.users do |user| %>
    <div class="media">
      <%= image_tag("profile.png", class: "profile-pic-mini mr-3") %>
      <div class="media-body">
        <h5 onclick="window.location.href = './user_events.html';" class="mb-0 mt-1 clickable">
          <%= user.name %>
        </h5>
        <strong>Followers:</strong> <%= user.followers.length %>
      </div>
    </div>
  <% end %>
</div>
